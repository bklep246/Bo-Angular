/**
 * Built on: 2015-10-30T20:40:42
 * Bento Modern v1.2.0
 * Copyright 2015 Thomson Reuters
 * Maintained by Chi Gao, Joe Huang, Aaron Mendez
 */
!function(a,b,c){"use strict";var d=a.module("bento.d3",[]);d.constant("bentoD3Config",{bentoColors:{green:"#85ab44",orange:"#ff8000",red:"#dc0a0a",blue:"#1472c2"},colors:["#dc0a0a","#ff8000","#ffb400","#b2b2b8","#6d6d78","#37383d","#78a22f","#387c2b","#096352","#0aa386","#0083bf","#005a84","#a00000","#dc0a0a","#bf086d","#f4317b","#dd40c6","#991a99","#46166b","#6234a4"],category20:function(){return b.scale.ordinal().range(this.colors)},getBentoColors:function(a){var b=a;return this.bentoColors[a]&&(b=this.bentoColors[a]),b},addVerticalGradientDef:function(a,b,c,d){var e=a.append("svg:defs").append("svg:linearGradient").attr("id",b).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%").attr("spreadMethod","pad");e.append("svg:stop").attr("offset","0%").attr("stop-color",c).attr("stop-opacity",1),e.append("svg:stop").attr("offset","100%").attr("stop-color",d).attr("stop-opacity",1)},mergeObjects:function(a,b){for(var c in b)try{b[c].constructor===Object?a[c]=this.mergeObjects(a[c],b[c]):a[c]=b[c]}catch(d){a[c]=b[c]}return a}}).directive("bentoD3VerticalSplitBars",["bentoD3Config","$window","$timeout",function(c,d,e){return{restrict:"EA",scope:{data:"="},link:function(f,g,h){var i,j={top:40,right:20,bottom:80,left:50},k=h.width?h.width:g[0].offsetWidth?g[0].offsetWidth:400,l=h.height?h.height:g[0].offsetHeight?g[0].offsetHeight:400,m=k-j.left-j.right,n=l-j.top-j.bottom,o=.5*n,p=h.ticks?h.ticks:3,q=b.select(g[0]).append("svg").attr("width","100%").attr("height",n+j.top+j.bottom).append("g").attr("transform","translate("+j.left+","+j.top+")"),r=c.bentoColors.orange,s=c.bentoColors.green;h.topColor&&(r=f.$parent.$eval(h.topColor)),h.bottomColor&&(s=f.$parent.$eval(h.bottomColor)),f.$watch("data",function(a){f.render(a)},!0),"true"===h.autoWidth&&(d.onresize=function(){f.$apply()},f.$watch(function(){return a.element(d)[0].innerWidth},function(){q.selectAll("*").remove(),i&&clearTimeout(i),i=e(function(){k=g[0].offsetWidth,m=k-j.left-j.right,f.render(f.data)},100)})),f.render=function(a){var d=b.scale.ordinal().rangeRoundBands([0,m],.35),e=b.svg.axis().scale(d).orient("bottom"),f=b.scale.linear().range([o,0]),g=b.svg.axis().scale(f).orient("left").ticks(p,""),i=b.scale.linear().range([o,n]),j=b.svg.axis().scale(i).orient("left").ticks(p,"");r instanceof Array&&2===r.length&&c.addVerticalGradientDef(q,"topColor",r[0],r[1]),s instanceof Array&&2===s.length&&c.addVerticalGradientDef(q,"bottomColor",s[0],s[1]),d.domain(a.map(function(a){return a[h.category]}));var k=b.max(a,function(a){return a[h.topBars]}),l=b.max(a,function(a){return a[h.bottomBars]}),t=k>l?k:l;f.domain([0,t]),i.domain([0,t]),q.append("g").attr("class","x axis").attr("transform","translate(0,0)").attr("fill","none").attr("stroke","none").attr("shape-rendering","crispEdges").call(e),q.append("g").attr("fill","none").attr("stroke","#000").attr("shape-rendering","crispEdges").attr("class","y axis").call(g),q.append("g").attr("fill","none").attr("stroke","#000").attr("shape-rendering","crispEdges").attr("class","y axis").call(j),q.selectAll(".bar").data(a).enter().append("rect").attr("class","bar").attr("x",function(a){return d(a[h.category])}).attr("width",d.rangeBand()).attr("fill",function(){return r instanceof Array?"url(#topColor)":r}).attr("height",0).attr("y",o).transition().duration(1e3).attr("y",function(a){return f(a[h.topBars])}).attr("height",function(a){return o-f(a[h.topBars])}),q.selectAll(".bar-bottom").data(a).enter().append("rect").attr("class","bar-bottom").attr("x",function(a){return d(a[h.category])}).attr("width",d.rangeBand()).attr("fill",function(){return s instanceof Array?"url(#bottomColor)":s}).attr("height",0).attr("y",o).transition().duration(1e3).attr("height",function(a){return i(a[h.bottomBars])-o}),q.selectAll("line.horizontal-grid").data(f.ticks(p)).enter().append("line").attr({"class":"horizontal-grid",x1:0,x2:m,y1:function(a){return f(a)},y2:function(a){return f(a)}}).style({stroke:"#000","stroke-opacity":"0.1"}),q.selectAll("line.bottom-horizontal-grid").data(i.ticks(p)).enter().append("line").attr({"class":"bottom-horizontal-grid horizontal-grid",x1:0,x2:m,y1:function(a){return i(a)},y2:function(a){return i(a)}}).style({stroke:"#000","stroke-opacity":"0.1"}),q.append("line").attr({"class":"middle-x-axis",x1:0,y1:o,x2:m,y2:o,stroke:"#eee","stroke-width":"3"}),q.selectAll(".x.axis text").attr("transform",function(){return"translate("+-1*this.getBBox().height+","+this.getBBox().height+")rotate(-45 0,0)"}).style("text-anchor","end").attr("x",-(1.35*o)).attr("y",1.35*o)}}}}]).directive("bentoD3ProgressMeter",["bentoD3Config",function(a){return{restrict:"EA",scope:{data:"="},link:function(d,e,f){function g(){if(h!==c){o.selectAll("*").remove();var a=0,d=0,e=[parseInt(h)],f=0;o.selectAll("text").data(e).enter().append("text").text(a).attr("fill",r).attr("y",j-2).attr("x",function(){var a=i+3;return"left"===n&&(a=0),a}).style("font-size",l+"px").attr("text-anchor",n).transition().duration(1500).tween("text",function(a){var c=b.interpolate(d,a);return function(a){d=Math.round(c(a)),this.textContent=d+"%"}});var g=0;if("left"===n){var k=o.select("text")[0][0];k.textContent="100%",f=k.getBBox().width,g=f}o.append("rect").attr("height",j).attr("width",i).attr("rx",m).attr("ry",m).attr("x",g).attr("y",0).attr("fill",q),o.append("rect").attr("height",j).attr("width",0).attr("x",g).attr("y",0).attr("rx",m).attr("ry",m).attr("fill",p).transition().duration(1500).attr("width",function(){return.01*h*i})}}var h,i=parseInt(f.width)||200,j=parseInt(f.height)||10,k=3*j,l=j,m=f.radius?parseInt(f.radius):0,n=f.alignment?f.alignment:"right",o=b.select(e[0]).append("svg").attr("width",i+k).attr("height",j),p=f.color?a.getBentoColors(f.color):a.bentoColors.orange,q=f.bgColor?a.getBentoColors(f.bgColor):"#ccc",r=f.bgColor?a.getBentoColors(f.bgColor):"#000";d.$watch("data",function(a){h=a,g()},!0),f.$observe("alignment",function(a){a&&(n=a,g())}),f.$observe("color",function(b){b&&(p=a.getBentoColors(b),g())})}}}]).directive("bentoD3HorizontalBars",["bentoD3Config","$window","$timeout",function(c,d,e){return{restrict:"EA",scope:{data:"="},link:function(f,g,h){var i,j=parseInt(h.margin)||20,k=parseInt(h.barHeight)||30,l=parseInt(h.barPadding)||5,m=b.select(g[0]).append("svg").style("width","100%");d.onresize=function(){f.$apply()},f.$watch(function(){return a.element(d)[0].innerWidth},function(){f.render(f.data)}),f.$watch("data",function(a){f.render(a)},!0),f.render=function(a){m.selectAll("*").remove(),a&&(i&&clearTimeout(i),i=e(function(){var d=b.select(g[0]).node().offsetWidth-j,e=f.data.length*(k+l),h=c.category20(),i=b.scale.linear().domain([0,b.max(a,function(a){return a.value})]).range([0,d]);m.attr("height",e),m.selectAll("rect").data(a).enter().append("rect").on("click",function(a){return f.onClick({item:a})}).attr("height",k).attr("width",140).attr("x",Math.round(j/2)).attr("y",function(a,b){return b*(k+l)}).attr("fill",function(a){return h(a.value)}).on("click",function(a){return f.onClick({item:a})}).transition().duration(1e3).attr("width",function(a){return i(a.value)}),m.selectAll("text").data(a).enter().append("text").attr("fill","#fff").attr("y",function(a,b){return b*(k+l)+15}).attr("x",15).text(function(a){return a.name+" ("+a.value+")"})},100))}}}}]).directive("bentoD3PercentArc",["bentoD3Config",function(a){return{restrict:"EA",scope:{data:"=",onClick:"&"},link:function(d,e,f){function g(a,c){a.attrTween("d",function(a){var d=b.interpolate(a.endAngle,c);return function(b){return a.endAngle=d(b),k(a)}})}var h=parseInt(f.size)||80,i=parseInt(f.size)||80,j=2*Math.PI,k=b.svg.arc().innerRadius(.9*h*.5).outerRadius(.5*h).startAngle(0),l=28*h/100,m=b.select(e[0]).append("svg").attr("width",h).attr("height",i).append("g").attr("transform","translate("+h/2+","+i/2+")"),n=f.color?a.getBentoColors(f.color):a.bentoColors.orange,o=f.bgColor?a.getBentoColors(f.bgColor):"#ddd";d.$watch("data",function(a){d.render(a)},!0),d.render=function(a){if(a!==c){m.selectAll("*").remove(),m.append("path").datum({endAngle:j}).style("fill",o).attr("d",k),m.append("path").datum({endAngle:0}).style("fill",n).attr("d",k).transition().duration(1500).call(g,.01*parseInt(a)*j);var d=0,e=0,f=[parseInt(a)];m.selectAll("text").data(f).enter().append("text").text(d).attr("fill",n).attr("y",.3*l).attr("x",0).style("font-size",l+"px").attr("text-anchor","middle").transition().duration(1500).tween("text",function(a){var c=b.interpolate(e,a);return function(a){e=Math.round(c(a)),this.textContent=e+"%"}})}},d.render()}}}]).directive("bentoD3PieChart",["bentoD3Config",function(a){return{restrict:"EA",scope:{data:"=",index:"=",onClick:"&",onHover:"&",onLeave:"&"},link:function(d,e,f){function g(a){if(a!==c){var e;u.selectAll(".arc").each(function(c,d){d===a?(e=c,b.select(this).classed("is-faded",!1).classed("is-selected",!0)):-1===a?h():b.select(this).classed("is-faded",!0).classed("is-selected",!1)}),d.onHover({item:e,index:a}),d.onClick({item:e,index:a})}}function h(){u.selectAll(".arc").classed("is-faded",!1).classed("is-selected",!1),d.onClick({item:{},index:-1})}function i(){var a=u.selectAll(".arc");f.onClick&&a.on("click",null),f.onHover&&a.on("mouseover",null),f.onLeave&&u.on("mouseleave",null)}var j=f.diameter?parseInt(f.diameter):120,k=f.padding?parseInt(f.padding):0,l=j+k,m=j+k,n=j/2,o=a.category20(),p=f.innerRadius?f.innerRadius:0,q=250,r=n+20,s=b.svg.arc().outerRadius(n).innerRadius(p),t=b.layout.pie().sort(null),u=b.select(e[0]).append("svg").attr("width",l).attr("height",m).append("g").attr("transform","translate("+l/2+","+m/2+")");d.$watchCollection("data",function(a){d.render(a)}),d.$on("$destroy",i),e.on("$destroy",i),d.$watch("index",function(a){g(a)}),d.render=function(a){var c=b.sum(a,function(a){return a.value});u.selectAll("*").remove();var e=[];a.forEach(function(a){e.push(a.value)});var i=u.selectAll(".arc").data(t(e)).enter().append("g").attr("class","arc");f.onClick&&i.on("click",function(a,c){var e=this,f=c;d.$apply(function(){b.select(e).classed("is-selected")?h():g(f)})}),f.onHover&&i.on("mouseover",function(a,b){var c=b;d.$apply(function(){g(c)})}),f.onLeave&&u.on("mouseleave",function(){d.$apply(function(){u.selectAll(".arc").classed("is-faded",!1).classed("is-selected",!1),d.onLeave()})}),i.append("path").style("fill",function(d,e){var f=a[e].color?a[e].color:o(e);return a[e].color=f,a[e].percent=b.round(d.value/c*100,1),f}).transition().ease("out").duration(q).attr("d",s),f.labelOutside?i.append("text").transition().ease("out").duration(q).attr("transform",function(a){var b=s.centroid(a),c=b[0],d=b[1],e=Math.sqrt(c*c+d*d);return"translate("+c/e*r+","+d/e*r+")"}).attr("class","label-outside").attr("text-anchor",function(a){return(a.endAngle+a.startAngle)/2>Math.PI?"end":"start"}).text(function(b,c){return a[c].label}):i.append("text").transition().ease("out").duration(q).attr("transform",function(a){return"translate("+s.centroid(a)+")"}).style("text-anchor","middle").text(function(b,c){return a[c].label})}}}}]).directive("bentoD3LineChart",["bentoD3Config",function(a){return{restrict:"EA",scope:{data:"=",onClick:"&"},link:function(c,d,e){var f=parseInt(e.size)||150,g=parseInt(e.size)||150,h=a.category20(),i=b.svg.arc().innerRadius(30).outerRadius(60),j=b.layout.pie().sort(null),k=b.select(d[0]).append("svg").attr("width",f).attr("height",g).append("g").attr("transform","translate("+f/2+","+g/2+")");c.$watch("data",function(a){c.render(a)},!0),c.render=function(a){k.selectAll("*").remove(),k.selectAll("path").data(j(a)).enter().append("path").attr("fill",function(a,b){return h(b)}).attr("d",i)}}}}])}(window.angular,d3);
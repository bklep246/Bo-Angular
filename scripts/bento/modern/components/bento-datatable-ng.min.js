/**
 * Bento Modern v0.8.13
 * Copyright 2015 Thomson Reuters
 * Maintained by Chi Gao, Joe Huang, Aaron Mendez
 */
!function(a,b){"use strict";a.module("bento.datatable",[]).directive("bentoDatatable",["$timeout","$log","$compile","$window",function(c,d,e,f){return{restrict:"A",scope:{itemSource:"=",columnDefinitions:"=",selectedItems:"=",multiSelectedItems:"=",rowClicked:"&",rowDblclicked:"&",headerClicked:"&",actionClicked:"&",checkboxClicked:"&",headerCheckboxClickState:"=",tableCreated:"&",page:"=",itemsPerPage:"=",searchTerm:"=",totalItems:"=",columnFilterDefinitions:"=",columnFilterToggle:"=",tableDrawn:"&",rowDetailsTemplate:"=",getExternalScopes:"&?externalScopes"},template:"<div><table></table></div>",replace:!0,link:function(g,h,i){function j(){h.on("click","tr",function(a){var b=this;g.$apply(function(){g.rowClickHandler(b,a)})}),h.on("dblclick","tr",function(a){g.rowDoubleClickHandler(this,a)}),h.on("click","thead th",function(a){"false"!==C&&$(this).index()>=G&&(g.DataTable.clear().draw(),z()),g.theadClickHandler($(this,a))}),h.on("click","tr [data-action]",function(a){a.stopPropagation(),g.actionsClickHandler($(this,a))}),h.on("click","tr [data-show-row-details]",function(){g.showRowDetails($(this))}),h.on("change","tbody tr input:checkbox",function(a){var b=this;g.$apply(function(){g.checkboxHandler($(b),a)})}),h.on("click","tbody tr input:checkbox",function(a){a.stopPropagation()}),h.on("change","thead:eq(0) tr input:checkbox",function(){var a=this;g.$apply(function(){g.headerCheckboxHandler($(a))})}),h.on("draw.dt",function(){g.onTableDraw()}),h.on("order.dt",function(){g.page?c(function(){g.page=g.DataTable.page.info().page+1}):d.warn("Bento DataTable - `page` is not defined")})}function k(){if("true"===i.columnGrouping&&i.columnDefinitions){var a="",c=1;h.find("thead tr").before('<tr role="row"></tr>');for(var d=h.find("thead tr:eq(0)"),e=h.find("thead tr:eq(1)"),f=0,j=0,k=g.columnDefinitions.length;k>j;j++){var l=e.children().eq(j-f);null===g.columnDefinitions[j].groupTitle||g.columnDefinitions[j].groupTitle===b?(l.appendTo(d),j>0&&null!==g.columnDefinitions[j-1].groupTitle&&g.columnDefinitions[j-1].groupTitle!==b&&l.addClass("group"),l.attr("rowspan",2),f+=1):g.columnDefinitions[j].groupTitle!==a?(a=g.columnDefinitions[j].groupTitle,c=1,d.append('<th colspan="'+c+'" class="group">'+a+"</th>"),l.addClass("group")):(c+=1,$("th:last-child",d).remove(),d.append('<th colspan="'+c+'" class="column-group group">'+a+"</th>"))}}}function l(){if(g.columnFilterDefinitions&&g.columnFilterDefinitions.length>0){var a=h.find("thead:eq(0)"),b='<thead class="column-filter-row"><tr></tr></thead>';$(a).after(b);for(var c=h.find(".column-filter-row tr"),d=0,e=g.columnFilterDefinitions.length;e>d;d++){var f=g.columnFilterDefinitions[d],i="cf_model_"+d;if(f.type&&"input"===f.type)c.append('<th><input ng-model="'+i+'" ng-change="filterColumn('+d+", "+i+","+f.exactMatch+')" type="text" /></th>');else if(f.type&&"select"===f.type){for(var j='<th><select ng-model="'+i+'" ng-change="filterColumn('+d+", "+i+","+f.exactMatch+')">',k=0,l=f.options.length;l>k;k++)j+='<option value="'+f.options[k].value+'">'+f.options[k].name+"</option>";j+="</select></th>",c.append(j)}else c.append("<th></th>")}g.$watch("columnFilterToggle",function(a){$(".column-filter-row",h).toggle(a)})}}function m(){var a=g.columnDefinitions;if(a&&a.length>0&&g.DataTable){if("true"===i.columnGrouping)return;a.forEach(function(a,b){if(g.DataTable.column(b).visible(a.visible),"undefined"!=typeof g.columnFilterDefinitions){var c=a.visible===!1?"none":"table-cell",d=b+1,e=h[0].querySelector(".column-filter-row th:nth-of-type("+d+")");e&&(e.style.display=c)}})}}function n(){g.DataTable&&g.DataTable.columns.adjust()}function o(a){if(J&&(!I||H)){H=!1,I=!0;for(var b=$("thead th",h),c=b.length,d=0;c>d;d+=1){var e=g.columnDefinitions[d];if(!e||e.bSortable!==!1&&e.sortable!==!1){var f="sorting";a===d&&(f="sorting_desc"===b[d].className?"sorting_asc":"sorting_asc"===b[d].className?"sorting_desc":"sorting_disabled"===b[d].className?"asc"===g.dataTableOptions.order[0][1]?"sorting_asc":"sorting_desc":"sorting_asc"),$(b[d]).attr("aria-controls",h.attr("id")),$(b[d]).removeClass(),$(b[d]).addClass(f),"sorting_asc"===f?$(b[d]).attr("area-sort","ascending"):"sorting_desc"===f?$(b[d]).attr("area-sort","descending"):"sorting"===f&&$(b[d]).removeAttr("area-sort")}}}}function p(a,b){for(var c=$(">td",a),d=[],e=0;e<c.length;e++){var f=g.columnDefinitions[e],h=null;h=f.mData?b[f.mData]:b[e],d[e]='<td><div class="control-group"><input type="text" value="'+h+'"></div></td>'}$(a).html(d),g.DataTable.sort().draw()}function q(a){for(var b=$(">td",a),c=0;c<b.length;c++);}function r(a){for(var b=$(">td",a),c=0;c<b.length;c++);}function s(b){var c=!1,d=$("input",b);return a.forEach(d,function(a){""===a.value?(c=!0,$(a).parent().addClass("error")):$(a).parent().removeClass("error")}),c}function t(){g.DataTable&&(g.selectedItems===b&&(g.selectedItems=[]),$("tbody tr",h).each(function(){var a=x(this);if(g.selectedItems.indexOf(a)<0){var b=$("input:checkbox",this);b.length&&(b.prop("checked",!0),g.selectedItems.push(a))}}))}function u(){g.DataTable&&(g.selectedItems===b&&(g.selectedItems=[]),$("tbody tr",h).each(function(){var a=x(this),b=g.selectedItems.indexOf(a);if(b>-1){var c=$("input:checkbox",this);c.length&&(c.prop("checked",!1),g.selectedItems.splice(b,1))}}))}function v(a){(g.selectedItems.length>0||a===!0)&&$("tbody tr",h).each(function(){var a=x(this);g.selectedItems.indexOf(a)>-1?$("input:checkbox",this).prop("checked",!0):($("input:checkbox",this).prop("checked",!1),$("input:checkbox","thead tr").prop("checked",!1))})}function w(){g.multiSelectedItems.length>0&&$("tbody tr",h).each(function(){var a=x(this);g.multiSelectedItems.indexOf(a)>-1})}function x(a){var b=g.DataTable.row(a).data();return b?JSON.stringify(b[i.uniqueKey]):-1}function y(){if(i.groupByColumn!==b&&"false"===C&&g.DataTable){var a=Number(i.groupByColumn);g.dataTable.rowGrouping({iGroupingColumnIndex:a,bExpandableGrouping:!0,asExpandedGroups:[],fnOnGrouped:function(){}})}}function z(){}function A(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}jQuery.fn.dataTableExt.oApi.fnSortNeutral=function(a){a.aaSorting=[],a.aiDisplay.sort(function(a,b){return a-b}),a.aiDisplayMaster.sort(function(a,b){return a-b}),a.oApi._fnReDraw(a)};var B=!1,C=!0,D=1,E=i.multiSelectedItems!==b&&i.multiSelectedItems.length>0?!0:!1;i.isRowEditable&&(B=g.$eval(i.isRowEditable)),i.serverSideData&&(C=i.serverSideData),g.dataTableOptions={},g.dataTableOptions=i.datatableOptions!==b&&i.datatableOptions.length>0?g.$parent.$eval(i.datatableOptions):{autoWidth:!1,stateSave:!1,paginate:!1,deferRender:!0,filter:!1,destroy:!1,processing:!0,ordering:!1,order:[[0,"asc"]],dom:'<"top">rt<"bottom"f><"clear">SR'},g.dataTableOptions.scrollY&&(g.$watch(function(){return h.width()},function(a,b){a!==b&&n()}),a.element(f).bind("resize",function(){g.$apply()})),g.dataTableOptions.rowCallback=function(){var b=g.dataTableOptions.rowCallback;return function(c,d){b&&b(c,d);var f=a.element(c);f.hasClass("compiled")||(f.addClass("compiled"),e(c)(g))}}();var F,G=g.dataTableOptions.order[0]&&g.dataTableOptions.order[0][0]?g.dataTableOptions.order[0][0]:-1,H=!1,I=!1,J=!1,K=[];h.find("th").each(function(a,b){K.push($(b).text())}),K.length>0&&(g.dataTableOptions.columns=K),"false"===C&&(g.$watch("page",function(a){g.DataTable&&(D=a-1,g.DataTable.page(D).draw(!1))}),g.$watch("itemsPerPage",function(a){g.DataTable&&g.DataTable.page.len(a).draw()}),g.$watch("searchTerm",function(a){if(g.DataTable){var b=String(a);g.dataTable.api().search(b).draw()}})),i.headerCheckboxClickState&&g.$watch("headerCheckboxClickState",function(a){a===!0?t():a===!1&&u()}),i.columnDefinitions!==b&&g.$watch("columnDefinitions",function(){m()},!0),g.$watchCollection("selectedItems",function(){g.selectedItems!==b&&v(!0)}),g.editClickHandler=function(a){var b=$(a).closest("tr"),c=g.DataTable.row(b).data();p(b,c),g.editRow=b},g.saveClickHandler=function(){},g.actionsClickHandler=function(a){var b=a.closest("tr"),c=a.data("action"),d=g.DataTable.row(b).data();g.actionClicked({action:c,rowData:d})},g.showRowDetails=function(a){if(i.rowDetailsTemplate){var b=a.closest("tr"),c=g.DataTable.row(b);c.child.isShown()?(c.child.hide(),b.removeClass("shown")):(c.child(g.rowDetailsTemplate(c.data())).show(),b.addClass("shown"))}},g.headerCheckboxHandler=function(a){a[0].checked?t():u()},g.checkboxHandler=function(a,c){if($("thead tr input:checkbox",h).prop("checked",!1),i.headerCheckboxClickState&&(g.headerCheckboxClickState="indeterminate"),i.uniqueKey){g.selectedItems===b&&(g.selectedItems=[]);var d=a.closest("tr"),e=a[0].checked,f=g.DataTable.row(d).data(),j=x(d),k=g.selectedItems.indexOf(j);k>-1&&!e?g.selectedItems.splice(k,1):0>k&&e&&g.selectedItems.push(j),i.checkboxClicked&&g.checkboxClicked({rowData:f,isChecked:e,changeEvent:c})}},g.rowClickHandler=function(a,b){var c=g.DataTable.row(a).data();if(!($(a).parent("thead").length>0)){var d=$(a).hasClass("selected");if(E){var e=x(a),f=g.multiSelectedItems.indexOf(e);f>-1?(g.multiSelectedItems.splice(f,1),$(a).removeClass("selected")):0>f&&(g.multiSelectedItems.push(e),$(a).addClass("selected"))}else d||($("tr.selected",h).removeClass("selected"),$(a).addClass("selected"));if(i.rowClicked&&g.rowClicked({rowElement:a,rowParameter:a,rowData:c,clickEvent:b}),B===!0){if(g.editRow){if(a.index()===g.editRow.index())return;var j=g.DataTable.row(g.editRow).data();if(s(a,c))return;q(g.editRow,j),r(g.editRow,j),g.editRow.removeClass("row_selected")}a.addClass("row_selected"),c=g.DataTable.row(a).data(),p(a,c),g.editRow=a}}},g.rowDoubleClickHandler=function(a,b){var c=g.DataTable.row(a).data();g.rowDblclicked({rowElement:a,rowParameter:a,rowData:c,clickEvent:b})},g.theadClickHandler=function(a,b){if(!$(a[0]).hasClass("sorting_disabled")){F=a.index(),H=!0;var c="asc";$(a[0]).hasClass("sorting_desc")&&(c="asc"),$(a[0]).hasClass("sorting_asc")&&(c="desc"),g.headerClicked({column:a[0].innerHTML,columnObject:g.columnDefinitions[F],sortDirection:c,clickEvent:b})}},g.onTableDraw=function(){$("thead tr input:checkbox",h).prop("checked",!1),g.totalItems!==b&&(g.totalItems=g.DataTable.page.info().recordsDisplay),g.tableDrawn(),g.dataTableOptions.scrollY&&n()},g.filterColumn=function(a,b,c){if(c){var d=A(b);g.DataTable.column(a).search(d?"^"+d+"$":"",!0,!1).draw()}else g.DataTable.column(a).search(b).draw()},g.$watchCollection("itemSource",function(c){if(g.columnDefinitions!==b&&0!==g.columnDefinitions.length){if("undefined"==typeof g.DataTable)"false"===C&&(D=g.page-1,g.dataTableOptions.paginate=!0,g.dataTableOptions.ordering=!0,g.dataTableOptions.displayLength=g.itemsPerPage,g.dataTableOptions.displayStart=D*g.itemsPerPage),i.columnDefinitions===b||Array.isArray(g.columnDefinitions)&&0===g.columnDefinitions.length?(g.dataTableOptions.columns=[],a.forEach(c,function(a,b){g.dataTableOptions.columns.push({data:b,title:b})})):g.dataTableOptions.columns=g.columnDefinitions,g.dataTable=$("table:eq(0)",h).dataTable(g.dataTableOptions),g.DataTable=g.dataTable.api(),0===c.length?(g.DataTable.clear().draw(),z()):g.DataTable.rows.add(c).draw(),k(),l(),j(),m(),i.groupByColumn!==b&&y(),g.tableCreated({dataTableAPI:g.DataTable}),J=!0,e($("thead",h))(g);else{var d=c||null;g.DataTable.clear().draw(),d&&d.length>0?(g.editRow&&(g.editRow=b),g.DataTable.rows.add(c).draw()):z()}!g.dataTableOptions.ordering&&g.dataTableOptions.aoColumns&&"false"!==C&&(F||(F=G),F>=0?o(F):G=0),g.selectedItems!==b&&g.selectedItems.length>0&&i.uniqueKey!==b&&g.itemSource&&g.itemSource.length>0&&v(),g.multiSelectedItems!==b&&g.multiSelectedItems.length>0&&i.uniqueKey!==b&&g.itemSource&&g.itemSource.length>0&&w()}})}}}])}(window.angular);
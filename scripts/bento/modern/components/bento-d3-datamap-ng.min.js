/**
 * Built on: 2015-10-30T20:40:42
 * Bento Modern v1.2.0
 * Copyright 2015 Thomson Reuters
 * Maintained by Chi Gao, Joe Huang, Aaron Mendez
 */
!function(a,b){"use strict";var c=a.module("bento.d3");c.directive("bentoD3DataMap",["bentoD3Config","$window","$timeout","$compile",function(b,c,d,e){return{restrict:"EA",scope:{options:"=",alpha:"="},link:function(c,d,e){function f(a,b){var c=d.find(".datamaps-hoverover").height(),e=d.height(),f=.5*c,g=a-f;return a>e-f&&(g=e-c),f+30>a&&(g=30),g}function g(a,b){var c=d.find(".datamaps-hoverover").width(),e=d.width(),f=60,g=a+f;return a>.5*e&&(g=a-c-.5*f),g}function h(a,b,h,i,j){var k=d3.select(j[0][0].parentNode).select(".datamaps-hoverover"),l=JSON.parse(b.attr("data-previous-attributes"));c.$apply(function(){c.alpha=h.id});var m=JSON.parse(b.attr("data-info")),n='<div class="hover-close-btn"><span class="bento-icon-close-x"></span></div>';if(m){k.html(function(){return i.popupTemplate(h,m)+n}).style("display","block").style("opacity","1").style("z-index",2);var o=k.select(".hover-close-btn");o.on("click",function(a){k.style("opacity","0").style("top","-9999999px"),c.$apply(function(){c.alpha=""})}),l?"dark"==e.theme?k.style("color",l.fill):(k.style("background-color",l.fill),o.style("background-color",l.fill)):k.style("background-color","#ccc");var p=d3.mouse(d[0]);k.style("top",f(p[1],j)+"px").style("left",g(p[0],j)+"px")}else k.style("opacity","0").style("top","-9999999px")}function i(){this.parentNode.appendChild(this)}function j(){var a=d3.select(d[0]).select("svg"),b=a.selectAll(".datamaps-subunit");b.on("mouseover",null),b.on("click",null),b.on("mouseout",null)}var k,l,m="",n={projection:"times",fills:{defaultFill:"#ccc"},geographyConfig:{dataUrl:null,hideAntarctica:!0,borderWidth:1,borderColor:"#ddd",popupTemplate:function(a,b){},popupOnHover:!0,highlightOnHover:!0,highlightFillColor:"#000",highlightFillOpacity:.2,highlightBorderColor:"rgba(0,0,0,0.12)",highlightBorderWidth:5},setProjection:function(a){var b=468,c=245,d=a.offsetWidth/b,e=a.offsetHeight/c,f=d>e?e:d,g=d3.geo.times().center([0,0]).scale(100*f).translate([a.offsetWidth/2,a.offsetHeight/2+30*f]),h=d3.geo.path().projection(g);return{path:h,projection:g}}},o={setProjection:function(a){var b=200,c=97,d=a.offsetWidth/b,e=a.offsetHeight/c,f=d>e?e:d,g=d3.geo.times().center([0,0]).scale(100*f).translate([a.offsetWidth/2,a.offsetHeight/2]),h=d3.geo.path().projection(g);return{path:h,projection:g}}},p=function(){l.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")"),l.select(".state-border").style("stroke-width",1.5/d3.event.scale+"px"),l.select(".county-border").style("stroke-width",.5/d3.event.scale+"px")};c.mapRollOver=function(a){m!=a&&console.log(a),m=a},c.mapIsDone=function(){},c.$watch("options",function(a){c.render(a)},!0),c.$on("$destroy",j),d.on("$destroy",j),c.render=function(e){var f=e?b.mergeObjects(n,a.copy(e)):n;f.element=d[0],f.done=c.mapIsDone(),"usa"===f.scope&&b.mergeObjects(f,o);var g=(new Datamap(f),d3.select(d[0]).select("svg")),e=f.geographyConfig;l=g.selectAll(".datamaps-subunit"),l.on("mouseover",function(a){var b=d3.select(this),c={fill:b.style("fill"),stroke:b.style("stroke"),"stroke-width":b.style("stroke-width"),"fill-opacity":b.style("fill-opacity")};b.style("stroke",e.highlightBorderColor).style("stroke-width",e.highlightBorderWidth).attr("data-previous-attributes",JSON.stringify(c)),/MSIE/.test(navigator.userAgent)||i.call(this)}).on("click",function(a){var b=d3.select(this),c={fill:b.style("fill"),stroke:b.style("stroke"),"stroke-width":b.style("stroke-width"),"fill-opacity":b.style("fill-opacity")};g.selectAll(".datamaps-subunit").style("stroke",e.borderColor).style("stroke-width",e.borderWidth),b.style("stroke",e.highlightBorderColor).style("stroke-width",e.highlightBorderWidth).attr("data-previous-attributes",JSON.stringify(c)),e.popupOnHover&&h(this,b,a,e,g)}).on("mouseout",function(){var a=d3.select(this),b=JSON.parse(a.attr("data-previous-attributes"));for(var c in b)a.style(c,b[c])}),k=d3.behavior.zoom().translate([0,0]).scale(1).scaleExtent([1,8]).on("zoom",p),g.call(k)}}}}])}(window.angular);
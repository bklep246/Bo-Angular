/**
 * Bento Modern v0.8.13
 * Copyright 2015 Thomson Reuters
 * Maintained by Chi Gao, Joe Huang, Aaron Mendez
 */
!function(a){"use strict";a.module("bento.tree",["bento.services"]).factory("treeSelection",function(){var b=function(){this.node=[],this.findElement=function(b,c,d,e){for(var f=!1,g=b.length-1;g>=0;g--){if(b[g][d]===e){this.clearNodes(),f=!0,"undefined"==typeof b[g].collapsed&&(b[g].collapsed=!1),b[g].selected="selected",this.updateSelection(b[g]);break}if(a.isArray(b[g][c])&&(f=this.findElement(b[g][c],c,d,e))){"undefined"==typeof b[g].collapsed&&(b[g].collapsed=!1);break}}return f},this.updateSelection=function(a){-1===this.node.indexOf(a)&&this.node.push(a)},this.getSelection=function(){return this.node},this.removeSelection=function(a){var b=this.node.indexOf(a);this.node.splice(b,1)},this.clearNodes=function(){this.node=[]},this.findSelectElement=function(){return this.getSelection()}},c=function(){return new b};return{getHelper:c}}).factory("treeHelper",function(){function a(a){for(var b=a[0].getElementsByTagName("span"),c=0,d=10,e=0;e<b.length;e++){var f=b[e],h=g(f,a[0])+f.offsetWidth;h>c&&(c=h)}a.css("min-width",c+d+"px")}function b(a,b){return"undefined"==typeof a.selectModel||"string"==typeof a.selectModel&&""===a.selectModel?b._selected:b[a.selectModel]}function c(a,b,c){"undefined"==typeof a.selectModel||"string"==typeof a.selectModel&&""===a.selectModel?b._selected=c:b[a.selectModel]=c}function d(a,b,c,e){if("undefined"!=typeof e&&(a[c]=e,a._indeterminate=!1,document.getElementById(a._id).indeterminate=!1),a[b]&&a[b].length>0){for(var f=!1,g=0;g<a[b].length;g++)f=d(a[b][g],b,c,a[c])||f;f&&!a[c]&&(a._indeterminate=!0,document.getElementById(a._id).indeterminate=!0)}return a[c]||a._indeterminate}function e(a,b,c){var d=a._parent;if(d){for(var f=d[b],g=!1,h=!1,i=!1,j=0;j<f.length;j++){var k=f[j];k._indeterminate?i=!0:k[c]?g=!0:h=!0}var l=document.getElementById(d._id);h||!g||i?!h||g||i?(h&&g||i)&&(d[c]=!1,d._indeterminate=!0,l.indeterminate=!0):(d[c]=!1,l.indeterminate=!1,d._indeterminate=!1):(d[c]=!0,l.indeterminate=!1,d._indeterminate=!1),e(d,b,c)}}function f(a,b){"undefined"==typeof a._id&&(a._id="bento-tree-node-checkbox-"+Math.round(1e12*Math.random()));var c=a[b];if(c&&c.length>0)for(var d=0;d<c.length;d++){var e=c[d];"undefined"==typeof e._parent&&(e._parent=a),f(e,b)}}function g(a,b){return a.parentNode.parentNode===b?a.offsetLeft-b.offsetLeft:a.offsetLeft+g(a.parentNode,b)}return{adjustMinWidth:a,formatNodeBranch:f,indeterminateRoot:e,checkOffspring:d,getSelectModelValue:b,setSelectModelValue:c}}).controller("mainTreeController",["$scope","$element","treeSelection","treeHelper","$timeout",function(b,c,d,e,f){var g=b.treeModel.length>0;if("undefined"==typeof b.treeSelectionHelper){b.treeSelectionHelper=d.getHelper();for(var h=0;h<b.treeModel.length;h++)e.formatNodeBranch(b.treeModel[h],b.nodeChildren);c.addClass("bento-tree-root"),b.$watchCollection("treeModel",function(){f(function(){e.adjustMinWidth(c)})}),f(function(){for(var a=0;a<b.treeModel.length;a++)e.checkOffspring(b.treeModel[a],b.nodeChildren,b.checkboxModel)})}if(g){var i=b.treeModel;if("undefined"==typeof b.treeCollapsed)for(var j=0;j<i.length;j++)"undefined"==typeof i[j].collapsed&&(i[j].collapsed=!1);else for(var k=0;k<i.length;k++)"undefined"==typeof i[k].collapsed&&(i[k].collapsed=b.treeCollapsed)}f(function(){for(var a=0;a<b.treeModel.length;a++){var c=b.treeModel[a];e.getSelectModelValue(b,c)&&b.labelSelect(c)}}),b.checkboxClick=function(a){var c=a||this.node;c._indeterminate=!1,document.getElementById(c._id).indeterminate=!1,f(function(){e.checkOffspring(c,b.nodeChildren,b.checkboxModel),e.indeterminateRoot(c,b.nodeChildren,b.checkboxModel),b.onCheckboxChange&&b.onCheckboxChange(c)})},b.labelSelect=function(c){var d="undefined"==typeof c?this.node:c;if("undefined"==typeof b.selectableModel||"boolean"!=typeof c[b.selectableModel]||c[b.selectableModel]){if(b.selectAsCheck)return d[b.checkboxModel]=!d[b.checkboxModel],void b.checkboxClick(d);if(b.expandOnlyModel&&d[b.expandOnlyModel])return void b.toggleSelect(d);var f=b.treeSelectionHelper.getSelection();if(b.multiSelect){var g=f.filter(function(a){return a===d?(e.setSelectModelValue(b,a,!1),!0):!1});g.length>0?(e.setSelectModelValue(b,g[0],!1),b.treeSelectionHelper.removeSelection(d)):(e.setSelectModelValue(b,d,!0),b.treeSelectionHelper.updateSelection(d))}else a.forEach(f,function(a){e.setSelectModelValue(b,a,!1)}),b.treeSelectionHelper.removeSelection(d),e.setSelectModelValue(b,d,!0),b.treeSelectionHelper.updateSelection(d);b.selectCallback&&b.selectCallback(d)}},b.getNodeSelectionClass=function(a){var c="";return c=e.getSelectModelValue(b,a)?"selected":"",("undefined"==typeof b.selectableModel||"undefined"==typeof a[b.selectableModel]||"boolean"==typeof a[b.selectableModel]&&a[b.selectableModel])&&(c+=" bento-selectable"),c},b.toggleSelect=function(a){a.collapsed=!a.collapsed,a.collapsed?"undefined"!=typeof b.collapsingCallback&&b.collapsingCallback&&b.collapsingCallback(a):"undefined"!=typeof b.expandingCallback&&b.expandingCallback&&b.expandingCallback(a)},b.loadMore=function(){b.limitAmount+=20,e.adjustMinWidth(c)},b.$on("$destroy",function(){b.treeSelectionHelper.clearNodes(),e.adjustMinWidth(c)})}]).directive("bentoTree",["$compile","$timeout","treeSelection","treeHelper","$recursionHelper",function(a,b,c,d,e){return{restrict:"A",scope:{treeId:"@",treeIcon:"@",treeCollapsed:"=",treeModel:"=",treeLabel:"@",nodeChildren:"@",collapsingCallback:"=",expandingCallback:"=",selectCallback:"=",multiSelect:"=",useCheckbox:"=",selectModel:"@",checkboxModel:"@",selectableModel:"@",expandOnlyModel:"@",selectAsCheck:"=",onCheckboxChange:"=",secondTreeIcon:"@",treeSelectionHelper:"=?"},templateUrl:"../templates/tree/bento-tree.html",replace:!0,compile:function(a){return e.compile(a)},controller:"mainTreeController"}}]).directive("lastWatch",["$timeout",function(a){return{restrict:"A",link:function(b){b.$watch("$last",function(c){c&&a(function(){b.$parent.loadMore()})})}}}])}(window.angular);
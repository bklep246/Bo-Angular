/**
 * Bento Modern v0.8.13
 * Copyright 2015 Thomson Reuters
 * Maintained by Chi Gao, Joe Huang, Aaron Mendez
 */
!function(a,b,c){"use strict";a.module("bento.fileselector",["bento.busyloader","bento.services"]).factory("$fileSelectorServices",["$bentoServices",function(b){var d=function(a,c,d,f){if("undefined"!=typeof c){for(var g=a.multiple()?c:[c[0]],h=[],i=0;i<g.length;i++){var j=g[i];e(j,f)&&h.push(j)}a.selectedFiles=h,d&&d({files:h}),b.safeApply(a)}},e=function(a,b){var c=b?b.trim():"",d=a.name.split("."),e=d[d.length-1];return"undefined"==typeof c||0===c.length?!0:-1!==b.search(e)?!0:!1},f=function(a){a.selectedFiles=c},g=function(b){var c=a.element('<input type="file" name="fileselect[]" class="sr-only" tabindex="-1"'+(b.multiple?" multiple":"")+" />");return c};return{resetFileSelector:f,isValidFileType:e,parseFiles:d,getFileInput:g}}]).controller("fileSelectorController",["$scope","$element","$timeout","$bentoServices","$fileSelectorServices",function(a,b,c,d,e){function f(b){e.parseFiles(a,b.target.files,a.onFileSelect,a.fileType)}var g=e.getFileInput(a);g.on("change",f),b.append(g),a.onBrowseClick=function(a){if(console.log(d.getIEVersion()),-1!==d.getIEVersion()){var b=document.createEvent("Event");b.initEvent("click",!0,!0),g[0].dispatchEvent(b)}else g[0].click();a&&(a.stopPropagation(),a.preventDefault())},a.$watch(function(){return a.selectedFiles?a.selectedFiles.length:0},function(b,c){if(c>b){var d=e.getFileInput(a);d.on("change",f),g.off("change",f),g.replaceWith(d),g=d}}),a.onRemoveClick=function(b){var c=a.selectedFiles[b];a.selectedFiles.splice(b,1),a.onFileRemove&&a.onFileRemove({file:c})},b[0].addEventListener("dragover",function(a){b.addClass("dragged-over"),a.stopPropagation(),a.preventDefault()}),b[0].addEventListener("dragleave",function(){b.removeClass("dragged-over")}),b[0].addEventListener("drop",function(c){b.removeClass("dragged-over"),e.parseFiles(a,c.dataTransfer.files,a.onFileSelect,a.fileType),c.stopPropagation(),c.preventDefault()})}]).directive("fileSelector",[function(){return{controller:"fileSelectorController",replace:!0,scope:{fileType:"@",onFileSelect:"&",onFileRemove:"&",multiple:"&"},templateUrl:"../templates/file_selector/bento-file-selector.html"}}])}(window.angular,window);
/**
 * Bento Modern v0.8.13
 * Copyright 2015 Thomson Reuters
 * Maintained by Chi Gao, Joe Huang, Aaron Mendez
 */
!function(a,b){"use strict";a.module("bento.multiselectoverlay",["bento.services"]).directive("bentoMultiselectOverlay",[function(){return{require:"ngModel",scope:{ngModel:"=",selectedItems:"=?",ngChange:"&",side:"@",doneButtonText:"@",selectAllText:"@",showAllText:"@",showSelectedText:"@",selectButtonText:"@",editButtonText:"@",selectedInfoText:"@",allSelectedInfoText:"@"},templateUrl:"../templates/multiselect_overlay/bento-multiselect-overlay.html",link:function(b,c){function d(){return b.data.buttonText=0===b.selectedItems.length?b.selectButtonText?b.selectButtonText:"Select":b.editButtonText?b.editButtonText:"Edit",0===b.selectedItems.length?void(b.data.selectItemFeedback=""):(b.data.selectItemFeedback=1===b.selectedItems.length?b.selectedItems[0].name:b.selectedItems.length===b.ngModel.length?b.allSelectedInfoText?b.allSelectedInfoText.replace("NUMBER",b.ngModel.length):"All ("+b.ngModel.length+") selected":b.selectedInfoText?b.selectedInfoText.replace("NUMBER",b.selectedItems.length):b.selectedItems.length+" selected",void(b.data.selectItemFeedback+="&nbsp;&nbsp;&nbsp;"))}var e=a.element(c[0].querySelector(".bento-side-overlay"));b.data={buttonText:b.selectButtonText?b.selectButtonText:"Select",selectItemFeedback:""},"undefined"==typeof b.selectedItems&&(b.selectedItems=[]),b.$watch("selectedItems.length",function(){e.hasClass("open")||d()}),b.onDoneClick=function(){d()}}}}]).directive("bentoSideOverlay",["$timeout",function(c){return{scope:!1,restrict:"A",link:function(d,e,f){function g(){if(e.removeClass("open"),b.removeEventListener("click",h),s.style.overflowY="auto",f.onDone){var a=f.onDone.replace("()","").trim();d[a]&&(d[a](),d.$apply())}}function h(a){e[0].contains(a.target)||g(a)}function i(a){var b=getComputedStyle(a).getPropertyValue("overflow-y"),c=getComputedStyle(a).getPropertyValue("overflow");return"auto"===b||"scroll"===b||"auto"===c||"scroll"===c?a:"BODY"===a.nodeName?a:i(a.parentElement)}function j(a,b){var c=b.getBoundingClientRect(),d=a.getBoundingClientRect();return{left:d.left-c.left,right:c.right-d.right,top:d.top-c.top,bottom:c.bottom-d.bottom,width:d.width,height:d.height}}function k(){var a=s.offsetHeight-2*l,b=f.overlayHeight?d[f.overlayHeight]:-1,c=j(n[0],s),e=c.top-(document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop),g=e+.5*n[0].offsetHeight;o.css("height",b+p[0].offsetHeight+"px");var h,i=l+25,k=o[0].offsetHeight;if(b>0?b>a-p[0].offsetHeight?o.css("max-height",a+"px"):o.css("max-height",b+p[0].offsetHeight+"px"):o.css("max-height",a+"px"),"BODY"===s.tagName)i>g?(document.documentElement?document.documentElement.scrollTop=c.top-i:s.scrollTop=c.top-i,g=i+.5*n[0].offsetHeight):g>s.offsetHeight-i&&(document.documentElement?document.documentElement.scrollTop=c.top+n[0].offsetHeight-s.offsetHeight+i:s.scrollTop=c.top+n[0].offsetHeight-s.offsetHeight+i,g=s.offsetHeight-i-.5*n[0].offsetHeight),h=.5*-k,-h>g-l?h=-(g-l+.25*n[0].offsetHeight):-h>s.offsetHeight-g-l&&(h=s.offsetHeight-g-l-k-.25*n[0].offsetHeight);else{c.bottom<i?s.scrollTop+=i-c.bottom:c.top<i&&(s.scrollTop-=i-c.top);var m=j(o[0],s);h=o[0].offsetTop,m.top<l?h=o[0].offsetTop-m.top+l:m.bottom<l&&(h=o[0].offsetTop+m.bottom-l)}o.css("top",h+"px")}var l=20,m=f.side?f.side.trim():"right",n=a.element(e[0].querySelector(".bento-side-overlay-toggle")),o=a.element(e[0].querySelector(".bento-side-overlay-container")),p=a.element(e[0].querySelector(".bento-side-overlay-container-footer")),q=(o[0].querySelector(".fill"),0),r=a.element(e[0].querySelector(".bento-side-overlay-container-footer-done")),s=i(e[0].parentElement);d.$watch(function(){return f.doneButtonText},function(a){a=String(a),r.text(0===a.trim().length||"undefined"===a?"Done":a)}),e.addClass("bento-side-overlay"),e.addClass("right"===m?"bento-side-overlay-right":"bento-side-overlay-left"),n.on("click touch",function(a){e.hasClass("open")?g(a):(e.addClass("open"),k(),c(function(){b.addEventListener("mousedown",h),b.addEventListener("touchstart",h)}),s.style.overflowY="hidden")}),r.on("click touch",g),f.overlayHeight&&d.$watch(function(){return d[f.overlayHeight.trim()]},function(a){q=a}),d.$watch(function(){return p[0].offsetHeight},function(a){o.css("padding-bottom",a+"px")})}}}]).directive("bentoSideOverlayToggle",[function(){return{restrict:"A",scope:!1,link:function(a,b){b.addClass("bento-side-overlay-toggle noselect")}}}]).directive("bentoSideOverlayContent",[function(){return{restrict:"A",scope:!1,link:function(a,b){b.addClass("bento-side-overlay-container"),b.wrap('<div class="bento-side-overlay-container-wrapper"></div>');var c='<div class="bento-side-overlay-left-arrow"><svg height="35" width="20"><polygon points="21,0 0.5,17.5 21,35" class="bento-side-overlay-triangle" /></svg></div>',d='<div class="bento-side-overlay-right-arrow"><svg height="35" width="20"><polygon points="-1,0 19.5,17.5 -1,35" class="bento-side-overlay-triangle" /></svg></div>';b.after(c),b.after(d);var e='<div class="bento-side-overlay-container-footer"><button class="btn btn-primary bento-side-overlay-container-footer-done"></button></div>';b.append(e)}}}]).filter("multiselectShowSelected",function(){return function(a,b){if(b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.__bsoChecked&&c.push(e)}return c}return a}}).directive("bentoMultiselectList",["$timeout","$bentoServices",function(a){return{require:"ngModel",templateUrl:"../templates/multiselect_list/bento-multiselect-list.html",scope:{ngModel:"=",ngChange:"&",selectedItems:"=?",side:"@",selectAllText:"@",showAllText:"@",showSelectedText:"@",maxAllowedHeight:"=?"},link:function(b,c){var d=!0;"undefined"==typeof b.selectedItems&&(b.selectedItems=[]),b.searchTerm={name:""},b.$watchCollection("selectedItems",function(a,c){for(var e=0;e<c.length;e++)c[e].__bsoChecked=!1;for(var e=0;e<a.length;e++)a[e].__bsoChecked=!0;b.selectAll=a.length===b.ngModel.length?!0:!1,d?d=!1:b.ngChange()});var e=c[0].querySelector(".bento-multiselect-search"),f=c[0].querySelector(".bento-multiselect-list-scroll-pane");c.addClass("bento-multiselect-list-wrapper"),b.$watch(function(){return e.offsetHeight},function(a){f.style.top=a+"px",b.maxAllowedHeight=e.offsetHeight+f.scrollHeight}),b.onSelectAllClick=function(){if(b.selectAll=!b.selectAll,b.selectAll){b.selectedItems=[];for(var a=0;a<b.ngModel.length;a++){var c=b.ngModel[a];b.selectedItems.push(c)}}else b.selectedItems=[]},b.onItemClick=function(a){var c=b.selectedItems.indexOf(a);-1===c?b.selectedItems.push(a):b.selectedItems.splice(c,1)},b.htmlEntities=function(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},a(function(){b.maxAllowedHeight=e.offsetHeight+f.scrollHeight})}}}])}(window.angular,window);